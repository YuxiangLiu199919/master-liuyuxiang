<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.etc.springcloud.mapper.CartMapper">

    <insert id="addGoodsToCart" parameterType="Cart">
        insert into cart(cid,user_id,product_id,amount) values(null,#{uid},#{gid},1)
    </insert>
<!--查用户购物车的商品-->
    <select id="queryCart" resultType="Cart">
        select c.*,g.name as GoodsName,g.price as GoodsPrice,g.image as GoodsImage,
               g.discount as GoodsDiscount
        from cart c,goods g where c.product_id=g.gid and c.user_id=#{uid}
    </select>
    <!--根据ID查询购物车的商品-->
    <select id="queryCartById" resultType="Cart">
        select c.*,g.name as GoodsName,g.price as GoodsPrice,g.image as GoodsImage,
               g.discount as GoodsDiscount
        from cart c,goods g where c.product_id=g.gid and c.user_id=#{uid}
        and g.gid=#{gid}
    </select>

    <!--根据用户ID计算购物车的商品总价-->
    <select id="queryCartTotalPrice" resultType="Cart">
        select c.user_id,sum(c.amount) as TotalAmount,sum(g.price * g.discount * c.amount) as GoodsTotalPrice
        from cart c,goods g where c.product_id=g.gid and c.user_id=#{uid}
        group by c.user_id
    </select>

    <update id="updataGoodsPquantity">
        update cart set amount=cart.amount+1 where product_id=#{gid} and user_id=#{uid}
    </update>
    <update id="updataGoodsMquantity">
        update cart set amount=cart.amount-1 where product_id=#{gid} and user_id=#{uid}
    </update>


    <!--    删除购物车的商品-->
    <delete id="deleteGoodsCart">
        delete from cart where product_id=#{gid} and user_id=#{uid}
    </delete>

    <!--    删除用户购物车的商品-->
    <delete id="deleteCart">
        delete from cart where user_id=#{uid}
    </delete>


</mapper>